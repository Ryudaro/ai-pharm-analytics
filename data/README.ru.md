# Требования к данным и взаимодействие с ними

Данный документ описывает, как система AI-Pharm Analytics работает с
данными, какие форматы данных поддерживаются и каким образом входные
данные подготавливаются для прогнозирования спроса.

Система ориентирована на работу с реальными аптечными данными в привычных
для пользователей форматах с последующим автоматическим приведением
их к единому внутреннему виду.

---

## Общий подход к работе с данными

В системе используется двухэтапная схема обработки данных:

1. **Входные данные (пользовательский уровень)**  
   Данные, предоставляемые в форматах, привычных для аптек
   (например, отчёты Excel).

2. **Внутренний формат данных**  
   Унифицированное представление, используемое для прогнозирования,
   оценки качества и последующих интеграций.

Такой подход позволяет не менять привычные процессы работы с данными
и одновременно сохранять целостность и масштабируемость системы.

---

## Входной формат данных (Excel / широкий формат)

### Описание

Основным поддерживаемым входным форматом является табличный формат,
широко используемый в аптечной практике.

Типовая структура:
- строки соответствуют отдельным товарам,
- столбцы соответствуют календарным датам,
- значения в ячейках отражают количество проданных упаковок.

### Пример (входной Excel-файл)

| Наименование товара | 2025-01-01 | 2025-01-02 | 2025-01-03 |
|---------------------|------------|------------|------------|
| Нурофен 200 мг      | 3          | 1          | 0          |
| Сальбутамол        | 2          | 2          | 1          |

### Как это интерпретируется

- Наименование товара — внешний идентификатор товара
- Заголовки столбцов — даты продаж
- Значения в ячейках — количество проданных упаковок за дату

Данный формат отражает реальную практику хранения данных в аптеках
и не требует предварительной подготовки со стороны пользователя.

---

## Идентификация товаров

Наименования товаров, используемые во входных файлах, не считаются
устойчивыми идентификаторами.

Внутри системы каждому товару присваивается стабильный внутренний
идентификатор — **`product_key`**.

Логика идентификации:
- при наличии устойчивого идентификатора (штрихкод, код учётной системы)
  он используется напрямую;
- в противном случае система формирует и сохраняет сопоставление между
  наименованием товара и внутренним `product_key`.

Это позволяет сохранять целостность временных рядов при повторных
загрузках данных.

---

## Внутренний формат данных

Перед построением прогнозов все входные данные преобразуются во
внутренний унифицированный формат.

### Пример внутреннего представления

| date       | product_key | product_name    | sales_quantity |
|------------|-------------|-----------------|----------------|
| 2025-01-01 | PRD_001     | Нурофен 200 мг  | 3              |
| 2025-01-02 | PRD_001     | Нурофен 200 мг  | 1              |
| 2025-01-01 | PRD_002     | Сальбутамол    | 2              |

Каждая строка соответствует продажам одного товара за одну дату.

Все модели прогнозирования работают исключительно с этим форматом данных.

---

## Дополнительные факторы (опционально)

Система поддерживает использование дополнительных факторов, влияющих
на спрос, при их наличии.

Примеры факторов:
- проведение промо-акций,
- отсутствие товара в наличии (out-of-stock),
- цена,
- погодные условия.

Дополнительные данные передаются отдельно и согласуются по дате и товару
(или локации) перед использованием в моделях.

---

## Допущения и ограничения

Система предполагает, что:
- данные отражают фактический реализованный спрос,
- значения продаж являются неотрицательными,
- возвраты и корректировки учтены до загрузки данных.

Система не моделирует:
- эффекты замещения товаров,
- ценообразование,
- маркетинговое планирование.

---

## Политика работы с данными

Реальные данные о продажах и иная коммерчески чувствительная информация
намеренно не хранятся и не публикуются в данном репозитории.

В репозитории могут размещаться:
- описания форматов данных,
- примеры и схемы,
- синтетические демонстрационные данные.
