# Контракт данных и поддерживаемые форматы

Данный документ описывает поддерживаемые форматы входных данных и
каноническое представление данных, используемое внутри системы
AI-Pharm Analytics.

Система ориентирована на работу с реальными аптечными данными и
поддерживает форматы, привычные для практического использования,
с последующим приведением их к единому внутреннему стандарту.

---

## Архитектурный подход

В системе используется двухуровневый подход к работе с данными:

1. **Входные форматы (пользовательские)**  
   Форматы, удобные для сотрудников аптек и применяемые в повседневной
   практике (например, отчёты Excel).

2. **Канонический формат (внутренний)**  
   Стандартизированное представление данных, используемое для
   прогнозирования, оценки качества и последующих интеграций.

Такое разделение позволяет сохранить простоту использования системы
и обеспечить масштабируемость и устойчивость логики прогнозирования.

---

## Входной формат данных (широкий / матричный)

### Описание

Основным поддерживаемым входным форматом является табличный формат,
традиционно используемый в аптечных организациях.

Характерные особенности:
- строки соответствуют отдельным товарам,
- столбцы соответствуют календарным датам,
- значения в ячейках отражают количество проданных упаковок.

### Пример структуры

| Наименование товара | 2025-01-01 | 2025-01-02 | 2025-01-03 |
|---------------------|------------|------------|------------|
| Товар А             | 3          | 1          | 0          |
| Товар Б             | 2          | 2          | 1          |

### Требования

- Один лист соответствует данным продаж одной аптеки или торговой точки
- Идентификатор товара может быть задан в виде:
  - наименования,
  - внутреннего кода,
  - штрихкода (при наличии)
- Заголовки столбцов должны интерпретироваться как календарные даты
- Значения продаж должны быть неотрицательными целыми числами

Данный формат не требует предварительной подготовки данных и
ориентирован на минимизацию нагрузки на пользователя.

---

## Идентификация и сопоставление товаров

Наименования товаров, используемые в пользовательских файлах, не
предполагаются стабильными.

Внутри системы каждому товару присваивается устойчивый
внутренний идентификатор — **`product_key`**.

Правила сопоставления:
- при наличии стабильного идентификатора (штрихкод, код учётной системы)
  он используется напрямую;
- в противном случае формируется таблица соответствий между
  пользовательским представлением товара и внутренним `product_key`.

Это обеспечивает сохранение целостности временных рядов между
различными загрузками данных.

---

## Канонический формат данных (длинный / нормализованный)

Все входные данные перед прогнозированием преобразуются в единый
канонический формат.

### Таблица продаж (каноническая)

| Поле              | Тип данных | Описание |
|-------------------|------------|----------|
| `date`            | Дата       | Дата продажи |
| `product_key`     | Строка     | Внутренний идентификатор товара |
| `sales_quantity`  | Целое число| Количество проданных упаковок |
| `pharmacy_id`     | Строка     | Идентификатор аптеки (опционально) |

Каждая строка соответствует продажам одного товара за одну дату.

Все модели прогнозирования и процедуры оценки качества работают
исключительно с данным форматом.

---

## Дополнительные факторы (признаки)

Система поддерживает подключение дополнительных факторов, которые
передаются в виде отдельных таблиц и объединяются с каноническими
данными продаж.

Примеры факторов:
- наличие промо-акций,
- информация об отсутствии товара (out-of-stock),
- цена,
- погодные показатели.

Все дополнительные данные должны быть согласуемы по дате и товару
(или локации) и рассматриваются как необязательные признаки.

---

## Допущения и ограничения

Система предполагает, что:
- данные отражают фактический реализованный спрос,
- значения продаж неотрицательны,
- возвраты и корректировки учтены до загрузки данных.

Система не моделирует:
- эффекты замещения товаров,
- стратегии ценообразования,
- маркетинговое планирование.

---

## Политика работы с данными

Реальные данные о продажах и иная коммерчески чувствительная информация
намеренно не хранятся и не публикуются в данном репозитории.

В репозитории могут размещаться:
- описания форматов и контрактов данных,
- схемы,
- синтетические или демонстрационные примеры.

Все реальные наборы данных остаются вне системы контроля версий.
